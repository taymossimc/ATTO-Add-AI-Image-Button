define(["jquery","core/str","core/ajax","core/notification"],function(e,t,n,o){var i=function(){console.log("Atto AI Magic settings JS initialized");var i=e("#atto_aimagic_test_connection"),s=e("#atto_aimagic_connection_result"),c=e("#atto_aimagic_connection_details");console.log("Test connection button found:",i.length>0);var a=[{key:"testconnection_testing",component:"atto_aimagic"},{key:"testconnection_success",component:"atto_aimagic"},{key:"testconnection_error",component:"atto_aimagic"},{key:"testconnection_assistant_valid",component:"atto_aimagic"},{key:"testconnection_assistant_invalid",component:"atto_aimagic"},{key:"testconnection_apikey_missing",component:"atto_aimagic"},{key:"testconnection_assistant_missing",component:"atto_aimagic"},{key:"test_success_popup",component:"atto_aimagic"},{key:"test_error_popup",component:"atto_aimagic"}],r={};t.get_strings(a).then(function(t){r.testing=t[0],r.success=t[1],r.error=t[2],r.assistantValid=t[3],r.assistantInvalid=t[4],r.apikeyMissing=t[5],r.assistantMissing=t[6],r.testSuccessPopup=t[7],r.testErrorPopup=t[8],i.on("click",function(t){console.log("Test connection button clicked"),t.preventDefault();var apiKey=$('input[name="s_atto_aimagic_apikey"]').val(),assistantId=$('input[name="s_atto_aimagic_assistantid"]').val(),baseUrl=$('input[name="s_atto_aimagic_baseurl"]').val();if(console.log("Values collected:",!!apiKey,!!assistantId,!!baseUrl),!apiKey)return s.html('<span class="text-danger">'+r.apikeyMissing+"</span>"),c.hide(),void o.alert("",r.testErrorPopup+": "+r.apikeyMissing);if(!assistantId)return s.html('<span class="text-danger">'+r.assistantMissing+"</span>"),c.hide(),void o.alert("",r.testErrorPopup+": "+r.assistantMissing);s.html('<span class="text-info">'+r.testing+' <i class="fa fa-spinner fa-spin"></i></span>'),c.hide();var p={methodname:"atto_aimagic_test_connection",args:{apikey:apiKey,assistantid:assistantId,baseurl:baseUrl}};console.log("Making AJAX call with request:",p),n.call([p])[0].done(function(e){console.log("AJAX call succeeded with response:",e),e.success?(s.html('<span class="text-success">'+r.success+" "+r.assistantValid+"</span>"),e.details?(c.html('<div class="alert alert-info">'+e.details+"</div>"),c.show()):c.hide(),o.alert("",r.testSuccessPopup)):(s.html('<span class="text-danger">'+r.error+" "+e.error+"</span>"),e.details?(c.html('<div class="alert alert-warning">'+e.details+"</div>"),c.show()):c.hide(),o.alert("",r.testErrorPopup+": "+e.error))}).fail(function(e){console.log("AJAX call failed with error:",e),s.html('<span class="text-danger">'+r.error+" "+e.message+"</span>"),c.hide(),o.exception(e),o.alert("",r.testErrorPopup+": "+e.message)})})}).catch(o.exception)};return{init:i}}); 