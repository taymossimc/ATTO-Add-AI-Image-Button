define("atto_aiimage/settings",["jquery","core/ajax","core/notification","core/str","core/config"],function(a,b,c,d,e){var f={init:function(){if(console.log("AI Image settings loaded"),"undefined"!=typeof M&&"undefined"!=typeof M.atto_aiimage&&"undefined"!=typeof M.atto_aiimage.settings)this.hasapikey=M.atto_aiimage.settings.hasapikey,this.model=M.atto_aiimage.settings.model,this.baseurl=M.atto_aiimage.settings.baseurl,this.timeout=M.atto_aiimage.settings.timeout,this.contextid=M.atto_aiimage.settings.contextid;this.setupTestConnectionButton()},setupTestConnectionButton:function(){var b=a("#atto_aiimage_test_connection");b.length?(b.on("click",this.testConnection.bind(this)),console.log("Test connection button initialized")):console.log("Test connection button not found")},testConnection:function(b){b.preventDefault();var f=a('input[name="s_atto_aiimage_apikey"]').val(),g=a('input[name="s_atto_aiimage_baseurl"]').val(),h=a('select[name="s_atto_aiimage_model"]').val(),i=a("#atto_aiimage_connection_result");if(console.log("Testing connection with model: "+h),!f)return void d.get_string("testconnection_apikey_missing","atto_aiimage").then(function(a){i.html('<span class="text-danger">'+a+"</span>")}).catch(c.exception);d.get_string("testconnection_testing","atto_aiimage").then(function(a){i.html('<span class="text-info">'+a+"</span>")}).catch(c.exception);var j={action:"test",contextid:this.contextid||0,sesskey:e.sesskey,prompt:"test connection",apikey:f,baseurl:g,model:h,timeout:this.timeout||30,aspectratio:"square"};console.log("Sending test request to: "+e.wwwroot+"/lib/editor/atto/plugins/aiimage/ajax.php"),a.ajax({method:"POST",url:e.wwwroot+"/lib/editor/atto/plugins/aiimage/ajax.php",data:j,dataType:"json",success:function(a){console.log("Test connection response:",a),a.success?d.get_string("testconnection_success","atto_aiimage").then(function(b){i.html('<span class="text-success">'+b+"</span>"),d.get_string("test_success_popup","atto_aiimage").then(function(a){c.addNotification({message:a,type:"success"})}).catch(c.exception)}).catch(c.exception):d.get_string("testconnection_error","atto_aiimage").then(function(b){i.html('<span class="text-danger">'+b+": "+a.error+"</span>"),d.get_string("test_error_popup","atto_aiimage").then(function(b){c.addNotification({message:b+" "+a.error,type:"error"})}).catch(c.exception)}).catch(c.exception)},error:function(a,b,e){console.error("AJAX Error:",e),d.get_string("testconnection_error","atto_aiimage").then(function(a){i.html('<span class="text-danger">'+a+": "+e+"</span>")}).catch(c.exception)}})},hasapikey:!1,model:"",baseurl:"",timeout:30,contextid:0};return f}); 